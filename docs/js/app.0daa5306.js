(function(e){function t(t){for(var i,a,s=t[0],l=t[1],c=t[2],f=0,d=[];f<s.length;f++)a=s[f],r[a]&&d.push(r[a][0]),r[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(d.length)d.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],i=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(i=!1)}i&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},r={app:0},o=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},2:function(e,t){},"527d":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var i=n("2b0e"),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wrapper"},[i("el-row",{staticClass:"full-height"},[i("el-scrollbar",{staticClass:"full-height"},[i("el-col",{staticClass:"container",attrs:{xs:24,md:18,xl:16}},[i("div",[i("div",{staticClass:"header flex-ver-center"},[i("img",{attrs:{src:n("e5d3")}}),i("div",[e._v("\n              DOSBOX GAME\n            ")])]),i("div",{staticClass:"main-box"},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{xs:24,md:16,xl:16}},[i("div",{ref:"wrapper",staticClass:"relative"},[i("canvas",{ref:"main"}),i("div",{ref:"pad",staticClass:"virtual-pad"},[i("div",{staticClass:"direction"},[i("div",[i("span",{ref:"directionBtn"})]),i("div",{ref:"direction"})]),i("div",{ref:"keyA",staticClass:"key-a flex-center"},[e._v("\n                      A\n                    ")]),i("div",{ref:"keyB",staticClass:"key-b flex-center"},[e._v("\n                      B\n                    ")])]),i("div",{ref:"fullNote",staticClass:"flex-center full-note hidden"},[e._v("\n                    横屏体验更佳哦\n                  ")])])]),i("el-col",{attrs:{xs:24,md:8,xl:8}},[i("div",{staticClass:"title flex"},[i("div",{staticClass:"flex1"},[e._v("\n                    "+e._s(e.runningGame?e.runningGame.title:"等待选择游戏")+"\n                  ")]),i("div",{staticClass:"small-tools flex"},[i("el-button",{attrs:{type:"primary",icon:"el-icon-zoom-in",size:"mini"},on:{click:e.fullGame}}),i("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.reloadGame}}),i("el-button",{attrs:{type:"primary",icon:"el-icon-picture",size:"mini"},on:{click:e.screenshot}}),i("el-button",{attrs:{type:"primary",icon:"el-icon-delete",size:"mini"},on:{click:e.clearDB}}),i("el-button",{attrs:{type:"primary",icon:"el-icon-download",size:"mini"},on:{click:e.exportDB}}),i("el-button",{attrs:{type:"primary",icon:"el-icon-upload2",size:"mini"},on:{click:e.importDB}})],1)]),i("el-row",{staticClass:"big-tools",attrs:{gutter:10}},[i("el-col",{attrs:{md:12,xl:8}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.fullGame}},[e._v("全屏游戏")])],1),i("el-col",{attrs:{md:12,xl:8}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.reloadGame}},[e._v("重新加载")])],1),i("el-col",{attrs:{md:12,xl:8}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.screenshot}},[e._v("保存截图")])],1),i("el-col",{attrs:{md:12,xl:8}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.clearDB}},[e._v("清空存档")])],1),i("el-col",{attrs:{md:12,xl:8}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.exportDB}},[e._v("导出存档")])],1),i("el-col",{attrs:{md:12,xl:8}},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.importDB}},[e._v("导入存档")])],1)],1)],1)],1)],1),i("div",{staticClass:"game-list"},[i("el-input",{attrs:{placeholder:"搜索内容"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),i("el-row",{attrs:{gutter:10}},e._l(e.gameList,function(t,n){return i("el-col",{key:n,attrs:{xs:8,sm:8,md:6,xl:6}},[i("div",{staticClass:"game-item",on:{click:function(n){return e.runGame(t)}}},[i("img",{style:"background-image:url('"+(t.poster?e.baseUrl+t.poster:"")+"')"}),i("div",[e._v(e._s(t.title))])])])}),1)],1)])])],1)],1),i("el-dialog",{attrs:{visible:e.loadingShown,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.loadingShown=t}}},[i("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.loadPercent}}),i("div",{staticClass:"text-center loading-text"},[e._v("\n      "+e._s(1==e.loadStage?"加载DOSBOX环境":2==e.loadStage?e.loadPercent>=99?"解压游戏包":"加载游戏包":"请稍候")+"\n    ")])],1)],1)},o=[],a=(n("34ef"),n("28a5"),n("e814")),s=n.n(a),l=(n("6b54"),n("d656")),c=n.n(l),u=n("d3d7"),f=n.n(u),d=(n("7f7f"),n("5d73")),h=n.n(d),p=n("5176"),m=n.n(p),v=(n("f559"),n("795b")),y=n.n(v),g=n("d225"),b=n("b0b4"),w=n("74ce"),x="dosbox",k=function(){function e(t){Object(g["a"])(this,e),this.db=new w["a"](x);this.db.version(1).stores({gameSave:"name"}),this.gameName=t}return Object(b["a"])(e,[{key:"genName",value:function(e){return this.gameName+"_"+e}},{key:"restoreName",value:function(e){var t=e.split("_");return t.length>=2?t[1]:e}},{key:"read",value:function(e){var t=this;return this.db.gameSave.where("name").startsWith(this.gameName).each(function(n){e(t.restoreName(n.name),n.files)})}},{key:"save",value:function(e,t){return t=t?t.constructor==Uint8Array?t:new Uint8Array(t):new Uint8Array,this.db.gameSave.put({name:this.genName(e),files:t})}},{key:"delete",value:function(e){return this.db.gameSave.where("name").equals(this.genName(e)).delete()}},{key:"deleteAll",value:function(){return this.db.gameSave.where("name").startsWith(this.gameName).delete()}}]),e}(),S=n("7c39"),B=n.n(S),D={staticBaseUrl:"https://static.gogogoghost.site/dosbox/"},L={gameBaseUrl:D.staticBaseUrl+"games/",posterBaseUrl:D.staticBaseUrl+"posters/",list:[{name:"pal",title:"仙剑奇侠传一",file:"pal.zip",command:"PAL!",poster:"pal.webp"},{name:"hospital",title:"主题医院",file:"hospital.zip",command:"hospital",mount:"cdrom",speed:3e4}]},A=function(e,t){var n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},F=function(e,t,n){return new y.a(function(i,r){Dos(e,{onprogress:function(e,t,i){n(e.startsWith("Resolving")?1:2,t,i)},onerror:function(){},log:function(){},wdosboxUrl:D.staticBaseUrl+"libs/js-dos/wdosbox.js"}).ready(function(e,n){e.createFile("dosbox.conf","\n            [sdl]\n            autolock=false\n            sensitivity=100\n            [cpu]\n            cycles=fixed ".concat(t.speed||3e3,"\n            ")),n(["-conf","dosbox.conf"]).then(function(n){m()(n,{exec:function(e){var t=this;return new y.a(function(n){t.shellInputClients.push(n);var i=!0,r=!1,o=void 0;try{for(var a,s=h()(e);!(i=(a=s.next()).done);i=!0){var l=a.value;t.shellInputQueue.push(l)}}catch(c){r=!0,o=c}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}t.requestShellInput()})},isDir:function(e){try{return this.api.FS.isDir(this.api.FS.stat(e).mode)}catch(t){return!1}},isFile:function(e){try{return this.api.FS.isFile(this.api.FS.stat(e).mode)}catch(t){return!1}},internalFile:[".","..","dev","home","proc","tmp"],eachFile:function(e,t){t=t||"/";var n=!0,i=!1,r=void 0;try{for(var o,a=h()(this.api.FS.readdir(t));!(n=(o=a.next()).done);n=!0){var s=o.value,l=!1,c=!0,u=!1,f=void 0;try{for(var d,p=h()(this.internalFile);!(c=(d=p.next()).done);c=!0){var m=d.value;m==s&&(l=!0)}}catch(y){u=!0,f=y}finally{try{c||null==p.return||p.return()}finally{if(u)throw f}}if(!l){var v=t+s;this.isFile(v)?e(v):this.isDir(v)&&this.eachFile(e,v+"/")}}}catch(y){i=!0,r=y}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}},writeFile:function(e,t){for(var n=e.split("/"),i="",r=0;r<n.length;r++)n[r]&&(i+="/"+n[r],r==n.length-1?this.api.FS.writeFile(i,t):this.isDir(i)||this.api.FS.mkdir(i))},saveFileToDB:function(e,t){this.db.save(e,t).catch(function(e){console.log(e)})},readFileFromDB:function(){var e=this;return this.db.read(function(t,n){e.writeFile(t,n)})},exportSaveFile:function(){var e=new B.a;this.db.read(function(t,n){t=t.substring(1,t.length),e.file(t,n)}).then(function(){e.generateAsync({type:"blob"}).then(function(e){A(t.name+".zip",e)})})},importSaveFile:function(){var e=this,t=document.createElement("input");t.type="file",t.style.display="none",t.addEventListener("change",function(){if("application/zip"!=t.files[0].type);else{var n=new FileReader;n.onload=function(){var t=new B.a;t.loadAsync(n.result).then(function(t){var n=function(n){if(t.files[n].dir)return i=n,"continue";t.file(n).async("uint8array").then(function(t){n="/"+n,e.saveFileToDB(n,t),e.writeFile(n,t)}),i=n};for(var i in t.files)n(i)})},n.readAsArrayBuffer(t.files[0])}}),document.body.appendChild(t),t.click(),document.body.removeChild(t)},listenFS:function(e,t,n){e=e||this.dos.FS,t=t||"root",n=n||"/";var i=!1,r=!0,o=!1,a=void 0;try{for(var s,l=h()(this.internalFile);!(r=(s=l.next()).done);r=!0){var u=s.value;u==t&&(i=!0)}}catch(x){o=!0,a=x}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}if(!i){var d=e[t].contents,p=!!d&&d.constructor==Object;if(p){for(var m in d)this.listenFS(d,m,n+m+"/");var v=this;e[t].contents=new Proxy(e[t].contents,{set:function(e,t,i,r){var o=f()(e,t,i,r);return d.constructor==Object&&v.listenFS(d,t,n+t+"/"),o},deleteProperty:function(e,t,i){var r=n+t;return this.db.delete(r).catch(function(e){console.log(e)}),c()(e,t,i)}})}else{n=n.substring(0,n.length-1);var y=this,g=e[t].timestamp,b=null,w=!1;Object.defineProperty(e[t],"timestamp",{get:function(){return g},set:function(i){g=i,b?w=!0:(w=!1,b=setInterval(function(){w||(clearInterval(b),b=null,y.saveFileToDB(n,e[t].contents)),w=!1},500))}})}}}}),window.dosbox=n,e.extract("".concat(L.gameBaseUrl).concat(t.file)).then(function(){n.db=new k(t.name),n.readFileFromDB().then(function(){n.listenFS();var e=["rescan"];"cdrom"==t.mount?e.push("mount d . -t cdrom"):"floppy"==t.mount&&e.push("mount d . -t floppy"),e.push(t.command),n.exec(e).then(function(){i(n)}).catch(function(e){n.exit(),r("run command error:"+e.toString())})}).catch(function(e){n.exit(),r("database error:"+e.toString())})}).catch(function(e){n.exit(),r("extract file error:"+e.toString())})})}).catch(function(e){r("dosbox error:"+e.toString())})})},E=n("5c96"),P=null,C={data:function(){return{baseUrl:L.posterBaseUrl,gameList:L.list,search:"",shownList:[],runningGame:null,loadingShown:!1,loadStage:0,loadPercent:0}},methods:{downKey:function(e){var t=new KeyboardEvent("keydown",{keyCode:e,bubbles:!0,cancelable:!0});this.$refs.main.dispatchEvent(t)},upKey:function(e){var t=new KeyboardEvent("keyup",{keyCode:e,bubbles:!0,cancelable:!0});this.$refs.main.dispatchEvent(t)},fullGame:function(){var e=this.$refs.wrapper,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;t&&t.call(e)},runGame:function(e){var t=this;P&&P.exit(),this.loadStage=0,this.loadPercent=0,this.loadingShown=!0,F(this.$refs.main,e,function(e,n,i){t.loadStage=e;var r=i/n*100;1==e?r/=2:2==e&&(r=r/2+50),t.loadPercent=s()(r)}).then(function(n){P=n,t.runningGame=e,t.loadingShown=!1}).catch(function(e){t.loadingShown=!1,t.$utils.log(e),E["Message"].error("加载失败")})},reloadGame:function(){var e=this;P&&E["MessageBox"].confirm("重启游戏请确保游戏进度已保存。","提示").then(function(){P.exit(),e.runGame(e.runningGame)}).catch(function(){})},screenshot:function(){P&&P.screenshot().then(function(e){for(var t=atob(e.split(",")[1]),n=new ArrayBuffer(t.length),i=new Uint8Array(n),r=0;r<t.length;r++)i[r]=t.charCodeAt(r);var o=new Blob([n]);A("dos.png",o)})},clearDB:function(){P&&E["MessageBox"].confirm("确定要删除所有已保存的存档吗？（当前游戏不受影响）","提示").then(function(){P&&P.db.deleteAll()}).catch(function(){})},exportDB:function(){P&&P.exportSaveFile()},importDB:function(){P&&P.importSaveFile()}},mounted:function(){var e=this;this.$nextTick(function(){var t=function(t){var n=e;return function(e){e.target.classList.add("key-touch"),n.downKey(t),e.preventDefault()}},n=function(t){var n=e;return function(e){e.target.classList.remove("key-touch"),n.upKey(t),e.preventDefault()}};e.$refs.keyA.addEventListener("mousedown",t(13)),e.$refs.keyA.addEventListener("touchstart",t(13)),e.$refs.keyB.addEventListener("mousedown",t(27)),e.$refs.keyB.addEventListener("touchstart",t(27)),e.$refs.keyA.addEventListener("mouseup",n(13)),e.$refs.keyA.addEventListener("touchend",n(13)),e.$refs.keyB.addEventListener("mouseup",n(27)),e.$refs.keyB.addEventListener("touchend",n(27));var i=0,r=e.$refs.directionBtn,o=function(e,t){return e<0&&e<t&&t<=-e?37:t>0&&-t<e&&e<=t?38:e>0&&-e<=t&&t<e?39:t<0&&t<=e&&e<-t?40:0},a=function(e,t){},s=function(){r.style.left="",r.style.top=""},l=function(e){e.constructor==TouchEvent&&(e.clientX=e.targetTouches[0].clientX,e.clientY=e.targetTouches[0].clientY);var t=e.target,n=t.getBoundingClientRect(),i=-(t.offsetWidth/2+n.left-e.clientX),r=t.offsetHeight/2+n.top-e.clientY;c(o(i,r)),a(e.clientX-n.left,e.clientY-n.top)},c=function(t){t!=i&&(0!=i&&e.upKey(i),0!=t&&e.downKey(t),i=t)},u=function(e){l(e),e.preventDefault()},f=function(e){i&&(l(e),e.preventDefault())},d=function(e){c(0),s(),e.preventDefault()};e.$refs.direction.addEventListener("mousedown",u),e.$refs.direction.addEventListener("touchstart",u),e.$refs.direction.addEventListener("mousemove",f),e.$refs.direction.addEventListener("touchmove",f),e.$refs.direction.addEventListener("mouseup",d),e.$refs.direction.addEventListener("touchend",d),window.addEventListener("resize",function(){document.fullscreenElement&&document.body.offsetHeight>document.body.offsetWidth?e.$refs.fullNote.classList.remove("hidden"):e.$refs.fullNote.classList.add("hidden")}),e.$refs.main.oncontextmenu=function(){return!1},e.$refs.pad.addEventListener("click",function(){var t=e.$refs.main,n=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock;n&&n.call(t)})})}},j=C,O=(n("5c0b"),n("88f1"),n("2877")),z=Object(O["a"])(j,r,o,!1,null,"29157bcf",null),G=z.exports,R=n("14e9"),U=n.n(R);n("0fae"),n("527d");i["default"].prototype.$utils={showLoading:function(e){return i["default"].prototype.$loading({lock:!0,text:e||"请稍候",background:"rgba(0,0,0,0.7)"})},log:function(e){console.log(e)}},i["default"].use(E["Row"]),i["default"].use(E["Col"]),i["default"].use(E["Dialog"]),i["default"].use(E["Progress"]),i["default"].use(E["Input"]),i["default"].use(E["Button"]),i["default"].use(U.a),new i["default"]({el:"#app",render:function(e){return e(G)}})},"5c0b":function(e,t,n){"use strict";var i=n("5e27"),r=n.n(i);r.a},"5e27":function(e,t,n){},"88f1":function(e,t,n){"use strict";var i=n("93f0"),r=n.n(i);r.a},"93f0":function(e,t,n){},e5d3:function(e,t){e.exports="data:image/webp;base64,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"}});