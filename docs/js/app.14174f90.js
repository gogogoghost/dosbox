(function(e){function t(t){for(var i,s,o=t[0],l=t[1],c=t[2],d=0,f=[];d<o.length;d++)s=o[d],a[s]&&f.push(a[s][0]),a[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(f.length)f.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,o=1;o<n.length;o++){var l=n[o];0!==a[l]&&(i=!1)}i&&(r.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},a={app:0},r=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"527d":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var i=n("2b0e"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wrapper"},[i("el-row",{staticClass:"full-height"},[i("el-scrollbar",{staticClass:"full-height"},[i("el-col",{staticClass:"container",attrs:{xs:24,md:18,xl:16}},[i("div",[i("div",{staticClass:"header flex-ver-center"},[i("img",{attrs:{src:n("e5d3")}}),i("div",[e._v("\n              DOSBOX GAME\n            ")])]),i("el-row",{staticClass:"main-box",attrs:{gutter:20}},[i("el-col",{attrs:{xs:24,md:16,xl:16}},[i("div",{ref:"wrapper",staticClass:"relative"},[i("canvas",{ref:"main"}),i("div",{staticClass:"virtual-pad"},[i("div",{staticClass:"direction"},[i("div",[i("span",{ref:"directionBtn"})]),i("div",{ref:"direction"})]),i("div",{ref:"keyA",staticClass:"key-a flex-center"},[e._v("\n                    A\n                  ")]),i("div",{ref:"keyB",staticClass:"key-b flex-center"},[e._v("\n                    B\n                  ")])]),i("div",{ref:"fullNote",staticClass:"flex-center full-note hidden"},[e._v("\n                  横屏体验更佳哦\n                ")])])]),i("el-col",{attrs:{xs:24,md:8,xl:8}},[i("div",{staticClass:"title"},[e._v("\n                "+e._s(e.runningGame?e.runningGame.title:"等待选择游戏")+"\n              ")]),i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{xs:8,sm:6,md:12,xl:8}},[i("el-button",{attrs:{type:"info",size:"small"},on:{click:e.fullGame}},[e._v("全屏游戏")])],1),i("el-col",{attrs:{xs:8,sm:6,md:12,xl:8}},[i("el-button",{attrs:{disabled:!e.dos,type:"info",size:"small"},on:{click:e.reloadGame}},[e._v("重新加载")])],1),i("el-col",{attrs:{xs:8,sm:6,md:12,xl:8}},[i("el-button",{attrs:{disabled:!e.dos,type:"info",size:"small"},on:{click:e.saveDB}},[e._v("保存存档")])],1),i("el-col",{attrs:{xs:8,sm:6,md:12,xl:8}},[i("el-button",{attrs:{disabled:!e.dos,type:"info",size:"small"},on:{click:e.loadDB}},[e._v("加载存档")])],1),i("el-col",{attrs:{xs:8,sm:6,md:12,xl:8}},[i("el-button",{attrs:{disabled:!e.dos,type:"info",size:"small"},on:{click:e.exportDB}},[e._v("导出存档")])],1),i("el-col",{attrs:{xs:8,sm:6,md:12,xl:8}},[i("el-button",{attrs:{disabled:!e.dos,type:"info",size:"small"},on:{click:e.importDB}},[e._v("导入存档")])],1)],1)],1)],1),i("div",{staticClass:"game-list"},[i("el-input",{attrs:{placeholder:"搜索内容"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),i("el-row",{attrs:{gutter:10}},e._l(e.gameList,function(t,n){return i("el-col",{key:n,attrs:{xs:8,sm:8,md:6,xl:6}},[i("div",{staticClass:"game-item",on:{click:function(n){return e.runGame(t)}}},[t.poster?i("img",{attrs:{src:e.baseUrl+t.poster}}):e._e(),i("div",[e._v(e._s(t.title))])])])}),1)],1)],1)])],1)],1),i("el-dialog",{attrs:{visible:e.loadingShown,"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.loadingShown=t}}},[i("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.loadPercent}}),i("div",{staticClass:"text-center loading-text"},[e._v("\n      "+e._s(1==e.loadStage?"加载DOSBOX环境":2==e.loadStage?"加载游戏包":"请稍候")+"\n    ")])],1)],1)},r=[],s=n("e814"),o=n.n(s),l=(n("6b54"),n("f499")),c=n.n(l),u=(n("7f7f"),n("34ef"),n("28a5"),n("5d73")),d=n.n(u),f=n("5176"),h=n.n(f),v=(n("f559"),n("795b")),p=n.n(v),m=n("d225"),b=n("b0b4"),g=n("74ce"),y="dosbox",w=function(){function e(t){Object(m["a"])(this,e),this.db=new g["a"](y),this.db.version(1).stores({gameSave:"name"}),this.gameName=t}return Object(b["a"])(e,[{key:"read",value:function(){var e=this;return new p.a(function(t,n){e.db.gameSave.where("name").equals(e.gameName).first().then(function(n){e.gameData=n?n.files:{},t(e.gameData)}).catch(function(e){n(e)})})}},{key:"save",value:function(){var e=this;return new p.a(function(t,n){e.db.gameSave.put({name:e.gameName,files:e.gameData}).then(function(e){t()}).catch(function(e){n()})})}},{key:"clear",value:function(){this.gameData={}}},{key:"add",value:function(e,t){this.gameData[e]=t}},{key:"eachFile",value:function(e){for(var t in this.gameData)e(t,this.gameData[t])}}]),e}(),x={gameBaseUrl:"/static/games/",posterBaseUrl:"/static/posters/",list:[{name:"pal",title:"仙剑奇侠传一",file:"pal.zip",command:"PAL!",poster:"pal.webp",saveFile:/.rpg$/}]},D=function(e,t,n){return new p.a(function(i,a){Dos(e,{onprogress:function(e,t,i){n(e.startsWith("Resolving")?1:2,t,i)},onerror:function(){},log:function(){},wdosboxUrl:"/static/libs/js-dos/wdosbox.js"}).ready(function(e,n){n([]).then(function(n){h()(n,{exec:function(e){var t=this;return new p.a(function(n){t.shellInputClients.push(n);var i=!0,a=!1,r=void 0;try{for(var s,o=d()(e);!(i=(s=o.next()).done);i=!0){var l=s.value;t.shellInputQueue.push(l),t.requestShellInput()}}catch(c){a=!0,r=c}finally{try{i||null==o.return||o.return()}finally{if(a)throw r}}})},isDir:function(e){try{return this.api.FS.isDir(this.api.FS.stat(e).mode)}catch(t){return!1}},isFile:function(e){try{return this.api.FS.isFile(this.api.FS.stat(e).mode)}catch(t){return!1}},internalFile:[".","..","dev","home","proc","tmp"],eachFile:function(e,t){t=t||"/";var n=!0,i=!1,a=void 0;try{for(var r,s=d()(this.api.FS.readdir(t));!(n=(r=s.next()).done);n=!0){var o=r.value,l=!1,c=!0,u=!1,f=void 0;try{for(var h,v=d()(this.internalFile);!(c=(h=v.next()).done);c=!0){var p=h.value;p==o&&(l=!0)}}catch(b){u=!0,f=b}finally{try{c||null==v.return||v.return()}finally{if(u)throw f}}if(!l){var m=t+o;this.isFile(m)?e(m):this.isDir(m)&&this.eachFile(e,m+"/")}}}catch(b){i=!0,a=b}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}},writeFile:function(e,t){for(var n=e.split("/"),i="",a=0;a<n.length;a++)n[a]&&(i+="/"+n[a],a==n.length-1?this.api.FS.writeFile(i,t):this.isDir(i)||this.api.FS.mkdir(i))},saveFileToDB:function(){var e=this,n=0;return this.eachFile(function(i){if(t.saveFile.test(i.toLowerCase())){var a=e.api.FS.readFile(i).buffer;e.db.add(i,a),n++}}),new p.a(function(t,i){e.db.save().then(function(e){t(n)}).catch(function(e){i(e)})})},readFileFromDB:function(){var e=this,t=0;return this.db.eachFile(function(n,i){e.writeFile(n,new Uint8Array(i)),t++}),t},exportSaveFile:function(){var e={name:t.name,db:{}};this.db.eachFile(function(t,n){e.db[t]=Array.prototype.slice.call(new Uint8Array(n))});var n=new Blob([c()(e)]),i=document.createElement("a");i.href=URL.createObjectURL(n),i.download=t.name+".json",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)},importSaveFile:function(e){var n=this,i=document.createElement("input");i.type="file",i.style.display="none",i.addEventListener("change",function(){if("application/json"!=i.files[0].type)e(-1);else{var a=new FileReader;a.onload=function(){var i;try{i=JSON.parse(a.result)}catch(o){return void e(-1)}if(i.name==t.name){for(var r in i.db=i.db||{},i.db)n.db.add(r,new Uint8Array(i.db[r]).buffer);n.db.save();var s=n.readFileFromDB();e(s)}else e(-2)},a.readAsText(i.files[0])}}),document.body.appendChild(i),i.click(),document.body.removeChild(i)}}),e.extract("".concat(x.gameBaseUrl).concat(t.file)).then(function(){n.exec(["rescan"]).then(function(){n.db=new w(t.name),n.db.read().then(function(){n.exec([t.command]).then(function(){i(n)}).catch(function(e){a(e)})}).catch(function(e){a("database read error:"+e.toString())})})}).catch(function(e){a("extract file error:"+e.toString())})})})})},k={name:"app",data:function(){return{baseUrl:x.posterBaseUrl,gameList:x.list,search:"",shownList:[],dos:null,runningGame:null,loadingShown:!1,loadStage:0,loadPercent:0}},methods:{downKey:function(e){var t=new KeyboardEvent("keydown",{keyCode:e,bubbles:!0,cancelable:!0});this.$refs.main.dispatchEvent(t)},upKey:function(e){var t=new KeyboardEvent("keyup",{keyCode:e,bubbles:!0,cancelable:!0});this.$refs.main.dispatchEvent(t)},fullGame:function(){var e=this.$refs.wrapper,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;"undefined"!=typeof t&&t&&t.call(e)},runGame:function(e){var t=this;this.loadStage=0,this.loadPercent=0,this.loadingShown=!0,D(this.$refs.main,e,function(e,n,i){t.loadStage=e;var a=i/n*100;1==e?a/=2:2==e&&(a=a/2+50),t.loadPercent=o()(a)}).then(function(n){t.dos=n,window.dos=n,t.runningGame=e,t.loadingShown=!1}).catch(function(e){t.loadingShown=!1,t.$utils.log(e),t.$message.error("加载失败")})},reloadGame:function(){this.dos&&(this.dos.exit(),this.runGame(this.runningGame))},saveDB:function(){var e=this,t=this.$utils.showLoading("保存中");this.dos&&this.dos.saveFileToDB().then(function(n){t.close(),e.$message.success("成功保存".concat(n,"个文件"))}).catch(function(n){e.$utils.log(n),t.close(),e.$message.error("保存时遇到问题")})},loadDB:function(){if(this.dos){var e=this.dos.readFileFromDB();this.$message.success("已加载".concat(e,"个文件"))}},exportDB:function(){this.dos&&this.dos.exportSaveFile()},importDB:function(){var e=this;this.dos&&this.dos.importSaveFile(function(t){t>=0?e.$message.success("成功导入".concat(t,"个文件")):-1==t?e.$message.error("文件格式有误"):-2==t&&e.$message.error("非该游戏存档")})}},mounted:function(){var e=this;this.$nextTick(function(){var t=function(t){var n=e;return function(e){e.target.classList.add("key-touch"),n.downKey(t),e.preventDefault()}},n=function(t){var n=e;return function(e){e.target.classList.remove("key-touch"),n.upKey(t),e.preventDefault()}};e.$refs.keyA.addEventListener("mousedown",t(13)),e.$refs.keyA.addEventListener("touchstart",t(13)),e.$refs.keyB.addEventListener("mousedown",t(27)),e.$refs.keyB.addEventListener("touchstart",t(27)),e.$refs.keyA.addEventListener("mouseup",n(13)),e.$refs.keyA.addEventListener("touchend",n(13)),e.$refs.keyB.addEventListener("mouseup",n(27)),e.$refs.keyB.addEventListener("touchend",n(27));var i=0,a=e.$refs.directionBtn,r=function(e,t){return e<0&&e<t&&t<=-e?37:t>0&&-t<e&&e<=t?38:e>0&&-e<=t&&t<e?39:t<0&&t<=e&&e<-t?40:0},s=function(e,t){a.style.left=e-a.offsetWidth/2+"px",a.style.top=t-a.offsetHeight/2+"px"},o=function(){a.style.left="",a.style.top=""},l=function(e){e.constructor==TouchEvent&&(e.clientX=e.targetTouches[0].clientX,e.clientY=e.targetTouches[0].clientY);var t=e.target,n=t.getBoundingClientRect(),i=-(t.offsetWidth/2+n.left-e.clientX),a=t.offsetHeight/2+n.top-e.clientY;c(r(i,a)),s(e.clientX-n.left,e.clientY-n.top)},c=function(t){t!=i&&(0!=i&&e.upKey(i),0!=t&&e.downKey(t),i=t)},u=function(e){l(e),e.preventDefault()},d=function(e){i&&(l(e),e.preventDefault())},f=function(e){c(0),o(),e.preventDefault()};e.$refs.direction.addEventListener("mousedown",u),e.$refs.direction.addEventListener("touchstart",u),e.$refs.direction.addEventListener("mousemove",d),e.$refs.direction.addEventListener("touchmove",d),e.$refs.direction.addEventListener("mouseup",f),e.$refs.direction.addEventListener("touchend",f),window.addEventListener("resize",function(){document.fullscreenElement&&document.body.offsetHeight>document.body.offsetWidth?e.$refs.fullNote.classList.remove("hidden"):e.$refs.fullNote.classList.add("hidden")})})}},F=k,L=(n("5c0b"),n("9c22"),n("2877")),S=Object(L["a"])(F,a,r,!1,null,"a63ad20a",null),E=S.exports,A=n("5c96"),B=n.n(A);n("0fae"),n("527d");i["default"].prototype.$utils={showLoading:function(e){return i["default"].prototype.$loading({lock:!0,text:e||"请稍候",background:"rgba(0,0,0,0.7)"})},log:function(e){console.log(e)}},i["default"].use(B.a),new i["default"]({el:"#app",render:function(e){return e(E)}})},"5c0b":function(e,t,n){"use strict";var i=n("5e27"),a=n.n(i);a.a},"5e27":function(e,t,n){},"9c22":function(e,t,n){"use strict";var i=n("bcf0"),a=n.n(i);a.a},bcf0:function(e,t,n){},e5d3:function(e,t){e.exports="data:image/webp;base64,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"}});